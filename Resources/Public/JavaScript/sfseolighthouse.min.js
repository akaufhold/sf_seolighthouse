require.config({paths:{moment:"//cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min",chart:"//cdn.jsdelivr.net/npm/chart.js@3.0.2/dist/chart.min",roughjs:"https://unpkg.com/roughjs@4.3.1/bundled/rough"},shim:{chartjs:{exports:"C"}}}),requirejs(["jquery"],(function(e){require(["moment","chart","roughjs"],(function(t,a){var s;requirejs(["TYPO3/CMS/Backend/Icons"],(function(e){e.getIcon("actions-chevron-down",e.sizes.small).done((function(e){s=e})),e.getIcon("content-widget-chart-bar",e.sizes.default).done((function(e){chartsBar=e}))}));(new function(){const t=[["accessibility","acs"],["best-practices","bps"],["performance","pes"],["pwa","pwas"],["seo","seos"]],a=[["first-contentful-paint","fcp",.15,"rgba(255, 159, 64, 1)"],["speed-index","si",.15,"rgba(255, 99, 132, 1)"],["interactive","tti",.25,"rgba(255, 205, 86, 1)"],["largest-contentful-paint","lcp",.15,"rgba(75, 192, 192, 1)"],["total-blocking-time","tbt",.25,"rgba(54, 162, 235, 1)"],["cumulative-layout-shift","cls",.05,"rgba(153, 102, 255, 1)"]];var i,r,o,n,c,l=this,d=e(".progressBar"),u=e(".progressBar").find(".counterContainer");l.init=function(){c=l.getCategoryList(),l.addCategoriesToTargetUrl(c),e(".getLighthouseData").on("click",(function(){e("#target").val(e(".newLighthouseStatistics").attr("id")),window.oacacc=document.getElementById("overallChartAccessibilty").getContext("2d"),window.oacbes=document.getElementById("overallChartBestPractices").getContext("2d"),window.oacper=document.getElementById("overallChartPerformance").getContext("2d"),window.oacpwa=document.getElementById("overallChartPwa").getContext("2d"),window.oacseo=document.getElementById("overallChartSeo").getContext("2d"),window.pac=document.getElementById("performanceAuditsChart").getContext("2d");e(this).data("format")&&e(this).data("format"),l.fetchLighthouseData(l.getTargetUrl())})),e("input[type=radio][name=device]").change((function(){e(".tx_sfseolighthouse").find(".custom-radio").find("label").removeClass("active"),e(this).parents(".custom-radio").find("label").addClass("active"),deviceUrl=l.getDeviceUrl(l.getDevice()),l.setTargetUrl(deviceUrl),c=l.getCategoryList(),l.addCategoriesToTargetUrl(c)})),e(".categoriesCheck").find(".custom-check").find("label").click((function(){"all"==e(this).parents(".custom-check").find(".form-check-input").val()?e(".form-check-label").removeClass("active"):e("input[value='all']").parents(".custom-check").find(".form-check-label").removeClass("active"),e(this).hasClass("active")?e(this).removeClass("active"):e(this).addClass("active"),c=l.getCategoryList(),l.addCategoriesToTargetUrl(c)})),l.showAddionalAudits(),e(".performanceMenu").find("a").click((function(){var t=e(this).attr("id").split("show")[1].charAt(0).toLowerCase()+e(this).attr("id").split("show")[1].substring(1);e(".performanceAudits").css({display:"none"}),"performanceAuditCharts"==t?e(".performanceListHeader").css({display:"none"}):e(".performanceListHeader").css({display:"block"}),e("."+t).css({display:"block"})}))},l.showAddionalAudits=function(){e(".auditButtons").find("a").click((function(){var t=e(this).attr("id").split("show")[1].charAt(0).toLowerCase()+e(this).attr("id").split("show")[1].substring(1);e("."+t).css({display:"block"})}))},l.activeListClick=function(){e(".list-lighthouse").on("click","li",(function(){var t=e(this);e(".list-lighthouse").find("li").removeClass("active"),e(t).hasClass("active")||e(t).addClass("active")}))},l.getCategoryList=function(){var t="";return category=e(".categoriesCheck").find(".form-check-label.active"),e(category).each((function(a,s){val=e(s).parents(".custom-check").find(".category").val().toUpperCase(),"ALL"!=val?(e(".saveCharts").css({display:"none"}),t+=val,t+=a+1!=category.length?",":""):(allCategory=e(".categoriesCheck").find(".form-check-label").not(".active"),e(".saveCharts").css({display:"block"}),e(allCategory).each((function(a,s){val=e(s).parents(".custom-check").find(".category").val().toUpperCase(),t+=val,t+=a+1!=allCategory.length?",":""})))})),t},l.addCategoriesToTargetUrl=function(t){var a="",s=t.split(",");e(s).each((function(e,t){a=l.addUrlParam(a,"category",t)})),l.setTargetUrl(l.getDeviceUrl(l.getDevice())+a)},l.addUrlParam=function(e,t,a){var s=t+"="+a,i="&"+s;return e&&(i=e.replace(new RegExp("([?&])"+a+"[^&]*"),"$1"+s),i+="&"+s),i},l.getTargetUrl=function(){return e(".targetUrl")[0].innerText},l.setTargetUrl=function(t){e(".targetUrl").html(t)},l.getDevice=function(){return e(".deviceRadio").find(".active").parents(".custom-radio").find(".device").val()},l.getDeviceUrl=function(t){return e(".getLighthouseData").data(t)},l.getSpeedColor=function(e){return e<.5?speedOut="#d8000c":e<.9?speedOut="#ffa400":e<=1&&(speedOut="#28a745"),speedOut},l.pbReset=function(){e(u).find(".counterAmount").css({width:"0%"}),e(u).removeClass("progress").removeClass("error").removeClass("success"),e(u).find(".counterTitle").find(".errorMessage").html("error")},l.setPbStatus=function(t){e(u).addClass(t),"success"!=t&&"error"!=t||e(u).find(".counterAmount").css({width:"100%"})},l.firstLetterUp=function(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()},l.fetchLighthouseData=function(t){l.pbReset(),l.setPbStatus("progress"),fetch(t).then((e=>e.json())).then((t=>{if(t.hasOwnProperty("error"))l.errorHandling(t.error.message);else{const d=t.lighthouseResult,u=d.audits;auditScreenshots=u["screenshot-thumbnails"],auditCategories=d.categories;var i=l.getCategoryList().split(","),c=e(i).length;l.pbReset(),l.setPbStatus("success"),e(".list-audits,.list-Addtional-Audits,.list-performance-audits").html(""),e("#device").val(l.firstLetterUp(l.getDevice())),r="<ul class='list-lighthouse list-score list-main list-group'>",e(i).each((function(t,i){t++;var p=i.toLowerCase().replace("_","-"),g="oac"+p.substring(0,3),h=d.categories[p].score,f=1-h,m=l.getSpeedColor(h);l.createCharts(window[g],"pie",p,p+" Score"),l.addDataSet(window[p+"Chart"],"Score",m,100*h,1,0),l.addDataSet(window[p+"Chart"],"","rgba(255, 255, 255, 1)",100*f,0,1),r+=l.getMainAudits(p,auditCategories,t,c),"PERFORMANCE"==i&&(l.createCharts(window.pac,"bar","audits"),o="",o+="<ul class='list-lighthouse list-lighthouse-"+p+" list-group'>"+l.getPerformanceAudits(a,u)+"</ul>",e(".list-performance-audits").append(o),e(".performance,.performanceAudits,.performanceHeadline,.performanceListHeader").css({display:"block"}),e(".performanceAuditCharts").css({display:"none"})),n="",n+="<div class='label toggle list-lighthouse collapsed' data-toggle='collapse' data-target='#list-additional-"+p+"' aria-expanded='false' aria-controls='list-additional-"+p+"'>"+auditCategories[p].title+s+"</div>",n+="<ol class='collapse list-lighthouse list-group' id='list-additional-"+p+"'>",n+=l.getAdditionalAudits(u),n+="</ol>",e(".list-Addtional-Audits").append(n),e(".newLighthouseStatistics").css({display:"block"})})),r+="</ul>",e(".list-audits").html(""),e(".list-audits").append(r),e(".list-audits").append(l.getScreenshots(auditScreenshots)),l.setTotalTime(d.timing.total),l.activeListClick()}}))},l.errorHandling=function(t){l.pbReset(),l.setPbStatus("error"),e(d).find(".errorMessage").append(": "+t.substring(0,130)),l.fetchLighthouseData(l.getTargetUrl())},l.setTotalTime=function(t){e(u).find(".totalTime").length?e(u).find(".totalTime").html((t/1e3).toFixed(2)+" s"):e(u).find(".counterTitle").append("<span class='totalTime'>"+(t/1e3).toFixed(2)+" s</span>")},l.getScreenshots=function(e){e.details.items},l.getMainAudits=function(a,s,o,n){var c,d,u="";return e(t).each((function(t,o){o[0]==a&&(d=s[a].score,c=l.getSpeedClass(d),color=l.getSpeedColor(d),i=s[a].title.replace("-"," "),r="",u+='<li class="list-group-item" id="list-'+a+'">',u+=l.addSpan("label",i),u+=l.addSpan("score "+c,d),u+="</li>",e("#"+o[1]).val(d))})),u},l.getPerformanceAudits=function(t,s){var r,o,n,c,d=1,u="";return t.forEach((function(t){n=s[t[0]].displayValue,o=s[t[0]].score,r=l.getSpeedClass(o),color=l.getSpeedColor(o),i=t[0].replace("-"," "),u+='<li class="list-group-item" id="list-'+(t[1]?t[1]:"")+'">',u+=l.addSpan("label",i),u+=l.addSpan("value",n),u+=l.addSpan("score "+r,o),u+="</li>",e("#"+t[1]).val(parseFloat(n.replace(",","."))),e("#"+t[1]+"s").val(parseFloat(o)),c=100*o,a.length==d?l.addDataSet(window.auditsChart,i,color,c,1==d?"1":"0",1):l.addDataSet(window.auditsChart,i,color,c,1==d?"1":"0",0),d++})),u},l.getAdditionalAudits=function(e){var t,a,r,o,n,c,d="";return Object.keys(e).sort().forEach((function(u){c=e[u].description,n=String(e[u].scoreDisplayMode),e[u].hasOwnProperty("details.screenshot")&&(o=e[u].details.screenshot),r=e[u].displayValue,a=e[u].score,"notApplicable"!=n&&(i=u.replace("-"," "),d+='<li class="list-group-item" id="'+u+'">',d+=l.addSpan("label",(c?s:"")+i),null!=r&&(d+=l.addSpan("value",r)),a&&(t=l.getSpeedClass(a),d+=l.addSpan("score "+t,a)),e[u].description&&(d+="<span class='description'>"+(e[u].title?"<b>"+e[u].title+"</b>":"")+e[u].description,e[u].hasOwnProperty("details.screenshot")&&(d+=o),d+="</span>"),d+="</li>")})),d},l.addSpan=function(e,t){var a='<span class="'+e+'">';return a+=t,a+="</span>"},l.getSpeedClass=function(e){return e<.5?speedOut="slow":e<.9?speedOut="average":e<=1&&(speedOut="fast"),speedOut},l.createCharts=function(e,t,a,s){var i=a+"Chart";void 0!==window[i]&&window[i].destroy(),window[i]=new Chart(e,{type:t,data:{datasets:[{data:[]}]},options:{plugins:{legend:{display:!1},title:{display:!0,text:s}},responsive:!0,maintainAspectRatio:!1,scales:{}}})};var p=[];l.addDataSet=function(e,t,a,s,i,r){e.data.labels.push(t),1==i&&(p={backgroundColor:[],borderColor:[],data:[]}),p.backgroundColor.push(a),p.borderColor.push(a),p.data.push(s),r&&(e.data.datasets.push(p),e.update())}}).init()}))}));